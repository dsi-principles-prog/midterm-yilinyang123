---
title: "10-import"
output: html_notebook
---

```{r libraries}
library(readr)
library(assertr)
library(tidyverse)
library(lubridate)
library(janitor)
```

## Load data

```{r load data}
dest <- read_csv("train_users_2.csv") %>% clean_names()
```

## Describe data

```{r dimension}
dim(dest)
```

The training data had the demographic and session information for 213451 users. It contains 16 variables in this data set.

```{r variable names}
names(dest)
```
**Description of Variables**

**date_account_created**: the date of account creation

**timestamp_first_active**: timestamp of the first activity, note that it can be earlier than date_account_created or date_first_booking because a user can search before signing up

**date_first_booking**: date of first booking for the user

**signup_flow**: the page a user came to signup up from

**language**: international language preference

**affiliate_channel**: what kind of paid marketing

**affiliate_provider**: where the marketing is e.g. google, craigslist, other

**first_affiliate_tracked**: whats the first marketing the user interacted with before the signing up

**country_destination**: the target variable to predict

```{r first device type}
dest %>% 
  distinct(first_device_type)
```

Users can use the web application or the android/iOS application.

```{r signup method}
dest %>% 
  distinct(signup_method)
```

User can sign up via facebook, goole account or basic method.

```{r country destination}
dest %>% 
  distinct(country_destination)
```

There are 12 possible outcomes of the destination country: 'US'-USA, 'FR'-France, 'CA'-Canada, 'GB'-Great Britain, 'ES'-Spain, 'IT'-Italy, 'PT'-Portugal, 'NL'-Netherlands,'DE'-Denmark, 'AU'-Australia, 'NDF' (no destination found), and 'other'. 

'NDF' is different from 'other' because 'other' means there was a booking, but is to a country not included in the list, while 'NDF' means there wasn't a booking.

## Test data

**Data Type for Each Column**

we could check the data type for each column using head()

```{r data type}
head(dest)
```

**gender**

```{r gender}
dest %>% 
  distinct(gender)
```

For "-unknown", it should be considered as missing values in gender

**date_first_booking**

```{r NA in date first booking}
dest %>%
  verify(not_na(date_first_booking))
```

There are 124,543 NA in date_first_booking. Thus, about 58% users didn't book a trip to any destination yet.

```{r NDF in country destination}
dest %>% 
  filter(country_destination=="NDF")
```

The number of users whose country destination is "NDF" is 124543, which is consistent with NA in date_first_booking. Thus, in the predict problem, we could predict all destinations to be NDF if data_first_booking is NA.

**age**

```{r NA in age}
dest %>%
  verify(not_na(age))
```

There are 87990 missing values in age.

```{r extreme values in age}
dest %>%
  assert(within_bounds(0,120), age)
```

There are 781 extreme values in age. It is possible that people put their year of birth instead of their age.

## Clean data

**timestamp_first_active**

we can transform timestamp to POSIXct objects

```{r timestamp}
dest <- dest %>%
  mutate(timestamp_first_active=ymd_hms(as.character(dest$timestamp_first_active)))
```

**gender**

There are four unique values in gender, '-unknown-', 'MALE', 'FEMALE', 'OTHER'. '-unknown-' represents missing values in **gender**. Thus, let's change all the "-unknown" in gender to NA so it would be easier when we want to exclude missiing values from analysis or use various functions in R for dealing with missing values.

```{r modify gender}
dest <- dest %>% 
  mutate(gender=ifelse(gender=="-unknown-",NA,gender))
```


**signup method**

change signup method to factor and convert from category to numeric. In this way, they can be used in statistical modeling where they will be implemented correctly, i.e., they will then be assigned the correct number of degrees of freedom. Besides, storing string variables as factor variables is a more efficient use of memory.

```{r change signup method to factor}
dest <- dest %>% 
  mutate(signup_method =factor(signup_method,labels=1:3))
```

Thus, in the factor, basic is set to be 1, facebook is set to be 2 and google is set to be 3

**language**

change language to factor for a more efficient use of memory and it would be easier to implement for modelling.

```{r change language method to factor}
dest <- dest %>% 
  mutate(language =factor(language))
```

**first browser**

change all the "-unknown-" in first browser to NA so it would be easier when we want to exclude missiing values from analysis or use various functions in R for dealing with missing values.

```{r modify first browser}
dest <- dest %>% 
  mutate(first_browser=ifelse(first_browser=="-unknown-",NA,first_browser))
```

**country destination**

change country_destination to factor for a more efficient use of memory and it would be easier to implement for modelling since there are 12 levels for the target variable-country destination.

```{r change country destination to factor}
dest <- dest %>% 
  mutate(country_destination =factor(country_destination))
```

